

<!doctype html>

<html lang="en">
    <head>
        <meta charset="utf-8">
        <script src="./web3.min.js"></script>
        <script src="./dist/harbour.js"> </script>
    </head>

    <body>
       <script defer> 
            // Init basic objects      
            var web3 = new Web3();
            web3.setProvider(new web3.providers.HttpProvider("http://localhost:8545"));
            var account = '0x321c00b46f44ea274923232e815aeaca7336f0be';
            var contractData = new Harbour.ContractData();
            var deployer = new Harbour.Deploy(web3, '0x321c00b46f44ea274923232e815aeaca7336f0be', 470000, 1000000000);

            // create contract data map
            var contractMap = [];
            contractMap.push(contractData.getContractDataObjectByName('votingRight', ['0x321c00b46f44ea274923232e815aeaca7336f0be']));
            contractMap.push(contractData.getContractDataObjectByName('votingStrategy', ['0x321c00b46f44ea274923232e815aeaca7336f0be']));

            // deploy contracts
            deployer.deployContracts(contractMap).then(function(result) {
                // connect to version contract
                var versionAddress = '0xa312d5a2cb26dd2da28ee34c6e6793949201868b';
                var versionConnectionModel = new Harbour.ConnectionModel(
                    web3,
                    contractData.getContractAbiByName('version'),
                    versionAddress,
                    account
                );
                var version = new Harbour.Version(versionConnectionModel);

                // create new DAO
                version.createCongress(result['votingRight'], result['votingStrategy']).then(function(result) {
                    console.log('DAO CREATED')
                    var payload = '';
                    var congressConnectionModel = new Harbour.ConnectionModel(
                        web3,
                        contractData.getContractDataObjectByName('congress'),
                        versionAddress, 
                        account
                    );
                    
                    // propose
                    var congress = new Harbour.Congress(congressConnectionModel);
                    congress.propose('myTestPropose', payload).then(function(result) {
                        console.log(result);
                    }).catch(function(error) {
                        console.log(error);
                    });

                }).catch(function(error){
                    console.log(error);
                });
            });
        </script>
    </body>
</html>
